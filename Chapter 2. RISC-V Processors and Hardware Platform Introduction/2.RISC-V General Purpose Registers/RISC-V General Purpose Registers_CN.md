# RISC-V寄存器说明

RISC-V的指令集定义了32个整数寄存器x0~X31,以及一个程序计数器(PC)保存当前指令的地址。寄存器的宽度由CPU的地址总线宽度决定，RV32的整数寄存器的宽度为32bit，RV64的整数寄存器的宽度为64bit。下表是32个整数通用寄存器的名称，ABI名称与功能说明：

| 寄存器  | ABI名称 | 说明                                            | 在调用中是否保留 |
| ------- | ------- | ----------------------------------------------- | ---------------- |
| x0      | zero    | 0值寄存器，硬编码为0，写入数据忽略，读取数据为0 | -                |
| x1      | ra      | 用于返回地址（return address）                  | No               |
| x2      | sp      | 用于栈指针（stack pointer）                     | -                |
| x3      | gp      | 用于通用指针（global pointer）                  | -                |
| x4      | tp      | 用于线程指针                                    | No               |
| x5      | t0      | 用于存放临时数据或者备用链接寄存器              | Yes              |
| x6~x7   | t1~t2   | 用于存放临时数据寄存器                          | No               |
| x8      | s0/fp   | 需要保存的寄存器或者帧指针寄存器                | Yes              |
| x9      | s1      | 需要保存寄存器                                  | Yes              |
| x10~x11 | a0~a1   | 函数参数或者返回值寄存器                        | No               |
| x12~x17 | a2-a7   | 函数传递参数寄存器                              | No               |
| x18~x27 | s2-s11  | 需要保存的寄存器                                | Yes              |
| x28~x31 | t3~t6   | 用于存放临时数据寄存器                          | No               |

如果系统支持浮点扩展，则系统将增加32个浮点寄存器，通常情况若仅支持单精度浮点则浮点寄存器的长度为32bit,若支持双精度浮点则浮点寄存器的宽度为64bit,此时进行单精度浮点运算仅使用浮点寄存器的低32bit。

下表是32个浮点寄存器的名称，ABI名称与功能说明：

| 寄存器 | ABI名称 | 说明                  | 在调用中是否保留 |
| ------ | ------- | --------------------- | ---------------- |
| f0-7   | ft0-7   | 浮点临时寄存器        | No               |
| f8-9   | fs0-1   | 浮点保存寄存器        | Yes              |
| f10-11 | fa0-1   | 浮点参数/返回值寄存器 | No               |
| f12-17 | fa2-7   | 浮点参数寄存器        | No               |
| f18-27 | fs2-11  | 浮点保存寄存器        | Yes              |
| f28-31 | ft8-11  | 浮点临时寄存器        | No               |

在进行RTOS移植时，我们需要实现线程的上下切换，在进行上下文切换时需要进行CPU现场的保存，所谓的CPU现场就是上述的寄存器以及一些控制状态寄存器。这里我们在图中介绍了上述寄存器在函数调用规范中的作用，便于我们在恢复现场时将保存栈空间中的数据加载至寄存器。

